!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e);class i{constructor(t=0,e=0){this.x=t,this.y=e}add(t){let e=new i;return e.x=this.x+t.x,e.y=this.y+t.y,e}subtract(t){let e=new i;return e.x=this.x-t.x,e.y=this.y-t.y,e}distance(t){return Math.sqrt((t.x-this.x)*(t.x-this.x)+(t.y-this.y)*(t.y-this.y))}}class n extends i{angle(){return Math.atan2(this.y,this.x)}add(t){let e=new n;return e.x=this.x+t.x,e.y=this.y+t.y,e}subtract(t){let e=new n;return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){this.x*=t,this.y*=t}angleTo(t){return Math.atan2(t.y-this.y,t.x-this.x)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(t){let e=this.angle();this.x=t*Math.cos(e),this.y=t*Math.sin(e)}flip(){this.x=-this.x,this.y=-this.y}}class h{constructor(t,e,s,h){this.pos=new i(t,e),this.speed=new n(s,h),this.steering=new n(0,0),this.PERSONAL_SPACE=20,this.highlight=!1}resetSteering(){this.steering=new n(0,0)}getSteering(t,e,s){let i=t.length();t.normalize(e),i<100?t.multiply(e*(i/100)):t.multiply(e);let n=t.subtract(this.speed);return n.normalize(s),n}steer(t,e){let s=t.subtract(this.speed);s.normalize(e),this.steering=this.steering.add(s)}applySteering(){this.speed=this.speed.add(this.steering)}get_velocity(){return this.speed.length()}get_direction(){return this.speed.angle()}set_direction(t){const e=this.get_velocity();this.speed.x=Math.cos(t)*e,this.speed.y=Math.sin(t)*e}collision(t){return this.pos.distance(t)<this.PERSONAL_SPACE}change_direction(t){this.speed.x=Math.cos(t)*this.speed.x-Math.sin(t)*this.speed.y,this.speed.y=Math.sin(t)*this.speed.x+Math.cos(t)*this.speed.y}change_speed(t){let e=this.speed.angle(),s=this.speed.length();this.speed.x=Math.cos(e)*(s+t),this.speed.y=Math.sin(e)*(s+t)}wrap(t,e){return e.x>t.width&&(e.x=0),e.y>t.height&&(e.y=0),e.y<0&&(e.y=t.height),e}predict_position(t,e,s){e.normalize(s);let n=new i(this.pos.x,this.pos.y);return n.x+=e.x,n.y+=e.y,this.wrap(t,n),n}move(t){this.pos.x+=this.speed.x,this.pos.y+=this.speed.y,this.wrap(t,this.pos)}draw(t,e=!1){t.beginPath(),t.arc(this.pos.x,this.pos.y,5,0,2*Math.PI),t.fillStyle="#0095DD",(this.highlight||e)&&(t.fillStyle="#DD9500"),t.fill(),t.closePath()}}class r{constructor(t,e,s){this.pos=new i(t,e),this.r=s,this.color="rgba(200, 200, 200, 0.5)"}collision(t){return this.pos.distance(t)<1.4*this.r}draw(t){t.beginPath(),t.arc(this.pos.x,this.pos.y,this.r,0,2*Math.PI),t.fillStyle=this.color,t.fill(),t.closePath()}}const o=t=>t.reduce((t,e)=>t+e,0)/t.length,a=1,l=1,c=3;class d{constructor(t){this.AGENT_NUMBER=50,this.OBSTACLE_NUMBER=10,this.setCanvasSize(t),this.agents=[],this.obstacles=[];for(let t=0;t<this.OBSTACLE_NUMBER;t+=1)this.obstacles.push(this.createObstacle());for(let t=0;t<this.AGENT_NUMBER;t+=1)this.agents.push(this.createAgent())}setCanvasSize(t){this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d"),this.context.canvas.width=window.innerWidth,this.context.canvas.height=window.innerHeight}createAgent(){let t=this.randomPos(100,100),e=this.randomSpeed(Math.random(6));for(t=t.add(new i(100,100));this.obstacleCollisions(t).length>0;)t=this.randomPos();return new h(t.x,t.y,e.x,e.y)}createObstacle(){let t=1;t=window.innerWidth>window.innerHeight?window.innerWidth/50:window.innerHeight/50;let e=this.randomPos(this.canvas.width,this.canvas.height),s=t/2+Math.random()*t;return new r(e.x,e.y,s)}randomPos(t,e){let s=new i;return s.x=Math.random()*t,s.y=Math.random()*e,s}randomSpeed(t){let e=new n(Math.cos(t),Math.sin(t));return e.normalize(c),e}obstacleCollisions(t){let e=[];for(let s=0;s<this.OBSTACLE_NUMBER;s+=1)this.obstacles[s].collision(t)&&e.push(s);return e}agentCollisions(t,e){let s=this.agents.indexOf(t),i=[];for(let t=0;t<this.AGENT_NUMBER;t+=1)t!==s&&this.agents[t].collision(e)&&i.push(t);return i}avoidObstacles(t){let e=t.predict_position(this.canvas,t.speed,c);this.obstacleCollisions(e).forEach(e=>{let s=this.obstacles[e].pos.subtract(t.pos),i=new n(-s.x,-s.y);t.steer(i,a)})}avoidOtherAgents(t){this.agentCollisions(t,t.pos).forEach(e=>{let s=this.agents[e].pos.subtract(t.pos),i=new n(-s.x,-s.y);t.steer(i,a)})}alignToOtherAgents(t){let e=this.agents.filter(e=>e.pos.distance(t.pos)<200),s=new n;s.x=o(e.map(t=>t.speed.x)),s.y=o(e.map(t=>t.speed.y)),s.normalize(l),t.steer(s,a)}centerOfFlock(t){let e=new i;return e.x=o(t.map(t=>t.pos.x)),e.y=o(t.map(t=>t.pos.y)),e}highlightFlock(t){this.context.beginPath(),this.context.arc(t.x,t.y,200,0,2*Math.PI),this.context.fillStyle="rgba(200, 200, 200, 0.2)",this.context.fill(),this.context.closePath()}stickToFlock(t){let e=this.agents.filter(e=>e.pos.distance(t.pos)<200),s=this.centerOfFlock(e);1===this.agents.indexOf(t)&&this.highlightFlock(s);let i=s.subtract(t.pos),h=new n(i.x,i.y),r=t.getSteering(h,c,a),o=t.predict_position(this.canvas,t.speed.add(r),c);0===this.agentCollisions(t,o).length&&t.steer(h,a)}move(t){t.resetSteering(),this.alignToOtherAgents(t),this.stickToFlock(t),this.avoidOtherAgents(t),this.avoidObstacles(t),t.applySteering(),t.speed.normalize(c),t.move(this.canvas)}tick(){if(this.context){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);for(let t=0;t<this.OBSTACLE_NUMBER;t+=1)this.obstacles[t].draw(this.context);for(let t=0;t<this.AGENT_NUMBER;t+=1){let e=this.agents[t];e.draw(this.context,e.highlight),this.move(e)}}}}s.d(e,"initCanvas",function(){return p});var p=()=>{let t=new d("canvas");setInterval(t.tick.bind(t),50)}}]);